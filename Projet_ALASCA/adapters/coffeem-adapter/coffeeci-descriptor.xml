<?xml version="1.0" encoding="UTF-8"?>
<control-adapter
    xmlns="http://www.sorbonne-universite.fr/alasca/control-adapter"
    uid="CM10000"
    offered="etape1.equipements.coffee_machine.interfaces.CoffeeMachineExternalControlJava4CI">

  
  <consumption nominal="1500" min="0" max="1500"/>

  
  <required>java.lang.Math</required>
  <required>fr.sorbonne_u.exceptions.PreconditionException</required>
  <required>fr.sorbonne_u.components.connectors.AbstractConnector</required>
  <required>etape1.equipements.coffee_machine.interfaces.CoffeeMachineExternalControlJava4CI</required>
  <required>etape1.equipements.coffee_machine.Constants</required>
  <required>etape1.bases.AdjustableCI</required>

  
  <instance-var  modifiers= "protected static" type="int" name="MIN_MODE" static-init="1"/>
   <instance-var  modifiers= "protected static" type="int" name="MAX_MODE" static-init="4"/>
   <instance-var  modifiers= "protected static" type="double" name="MAX_ADMISSIBLE_DELTA" static-init="10.0"/>
   <instance-var  modifiers= "protected static" type="double" name="TARGET_TEMPERATURE" static-init="100.0"/>
   <instance-var  modifiers= "protected" type="int" name="currentMode" static-init="1"/>
   <instance-var  modifiers= "protected" type="boolean" name="isSuspended" static-init="false"/>

 
	<internal  modifiers= "protected" name="computePowerLevel" type="double">
        <parameter type="int" name="mode"/>
        <thrown>java.lang.Exception</thrown>
        <body>
            if (mode == 1) {
				return 3.0;
			} else if (mode == 2) {
				return 700.0;
			} else if (mode == 3) {
				return 1000.0;
			} else if (mode == 4) {
				return 1500.0;
			} else  {
				return 3.0;
			} 
        </body>
    </internal>

    <internal  modifiers= "protected" name="setPowerLevel" type="void">
        <parameter type="double" name="newPowerLevel"/>
        <thrown>java.lang.Exception</thrown>
        <body equipmentRef="coffee">
            double maxPowerLevel = coffee.getMaxPowerLevelJava4();
            if (newPowerLevel &gt; maxPowerLevel) newPowerLevel = maxPowerLevel;
            coffee.setCurrentPowerLevelJava4(newPowerLevel);
        </body>
    </internal>

    <internal  modifiers= "protected" name="computeAndSetNewPowerLevel" type="void">
        <parameter type="int" name="newMode"/>
        <thrown>java.lang.Exception</thrown>
        <body equipmentRef="coffee">
            double newPowerLevel = computePowerLevel(newMode);
            setPowerLevel(newPowerLevel);
        </body>
    </internal>

    <!-- ========================================================= -->
    <!-- Operations (AdjustableCI interface)                       -->
    <!-- ========================================================= -->
    

        <maxMode>
            <body>return MAX_MODE;</body>
        </maxMode>

        <upMode>
            <body equipmentRef="coffee">
                currentMode++;
                coffee.setMode(currentMode);
                computeAndSetNewPowerLevel(currentMode);
                return true;
            </body>
        </upMode>

        <downMode>
            <body equipmentRef="coffee">
                currentMode--;
                coffee.setMode(currentMode);
                computeAndSetNewPowerLevel(currentMode);
                return true;
            </body>
        </downMode>

        <setMode>
            <parameter  name="modeIndex"/>
            <body>
                currentMode = modeIndex;
                computeAndSetNewPowerLevel(currentMode);
                return true;
            </body>
        </setMode>

        <currentMode>
            <body>return currentMode;</body>
        </currentMode>

        <getModeConsumption>
            <parameter name="modeIndex"/>
            <body>
                return computePowerLevel(modeIndex);
            </body>
        </getModeConsumption>

        <suspended>
            <body>return isSuspended;</body>
        </suspended>

        <suspend>
            <body equipmentRef="coffee">
                coffee.setCurrentPowerLevelJava4(0.0);
                isSuspended = true;
                return isSuspended;
            </body>
        </suspend>

        <resume>
            <body equipmentRef="coffee">
                computeAndSetNewPowerLevel(currentMode);
                isSuspended = false;
                return true;
            </body>
        </resume>

        <emergency>
            <body equipmentRef="coffee">
                double temperature = coffee.getTemperatureJava4();
                if (temperature - TARGET_TEMPERATURE &gt;= MAX_ADMISSIBLE_DELTA)
                    return 1.0;
                return 0.0;
            </body>
        </emergency>

   

</control-adapter>